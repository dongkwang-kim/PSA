# Conversational Product Search Agent

ë³¸ í”„ë¡œì íŠ¸ëŠ” ë©”íƒ€ë°ì´í„°ì™€ ë¦¬ë·° ë°ì´í„°ë¥¼ ê²°í•©í•œ ëŒ€í™”í˜• ìƒí’ˆ ê²€ìƒ‰ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì´ˆê¸° ì§ˆë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ, ì—ì´ì „íŠ¸ê°€ ì ì ˆí•œ ì§ˆì˜ë¡œ ë³€í™˜í•˜ê³  ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë°˜ë³µì ìœ¼ë¡œ ì§ˆë¬¸ì„ ìƒì„±í•˜ì—¬ ì‚¬ìš©ì ìš”êµ¬ë¥¼ êµ¬ì²´í™”í•˜ëŠ” ì¸í„°ë™í‹°ë¸Œí•œ ê²€ìƒ‰ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.

## Overview

### Workflow

| ë‹¨ê³„               | ì—­í•                                  | Input      | Output                          |
| ---------------- | ---------------------------------- | ---------- | ------------------------------- |
| **Generation 1** | ì‚¬ìš©ì ì§ˆì˜ë¥¼ ì—ì´ì „íŠ¸ê°€ ì´ˆê¹ƒê°’ìœ¼ë¡œ ë³€í™˜             | ìœ ì € â†’ ì—ì´ì „íŠ¸  | ì´ˆê¸° ì§ˆë¬¸ â†’ **ì´ˆê¸° ì¿¼ë¦¬**               |
| **Retrieval 1**  | ì´ˆê¸° ì¿¼ë¦¬ë¡œ ìƒí’ˆ ê²€ìƒ‰ ìˆ˜í–‰                    | ì—ì´ì „íŠ¸ â†’ ê²€ìƒ‰ê¸° | ì´ˆê¸° ì¿¼ë¦¬ â†’ **ìƒí’ˆ ê´€ë ¨ ë¬¸ì„œ 20ê°œ**        |
| **Generation 2** | ê²€ìƒ‰ ê²°ê³¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ì§ˆë¬¸ ìƒì„±               | ê²€ìƒ‰ê¸° â†’ ì—ì´ì „íŠ¸ | ìƒí’ˆ ë¬¸ì„œ â†’ **ìƒˆë¡œìš´ ì§ˆë¬¸**              |
| **User Prompt**  | ì‚¬ìš©ìë¡œë¶€í„° ì‘ë‹µ ì…ë ¥ ë°›ìŒ                    | ì—ì´ì „íŠ¸ â†’ ìœ ì €  | ì§ˆë¬¸ â†’ **ë‹µë³€**                     |
| **Generation 3** | ì‘ë‹µê³¼ ëŒ€í™” ì´ë ¥ ê¸°ë°˜ ì¿¼ë¦¬ ì¬êµ¬ì„±                | ìœ ì € â†’ ì—ì´ì „íŠ¸  | ì§ˆë¬¸ + ë‹µë³€ + history â†’ **ì¬êµ¬ì„±ëœ ì¿¼ë¦¬** |
| **Retrieval 2**  | ì¬êµ¬ì„±ëœ ì¿¼ë¦¬ë¡œ ë‹¤ì‹œ ê²€ìƒ‰                     | ì—ì´ì „íŠ¸ â†’ ê²€ìƒ‰ê¸° | ì¬êµ¬ì„±ëœ ì¿¼ë¦¬ â†’ **ìƒí’ˆ ê´€ë ¨ ë¬¸ì„œ 20ê°œ**      |
| **Generation 4** | ê²°ê³¼ ë° ì´ë ¥ì„ ê¸°ë°˜ìœ¼ë¡œ ì¶”ê°€ ì§ˆë¬¸ ìƒì„±             | ê²€ìƒ‰ê¸° â†’ ì—ì´ì „íŠ¸ | ë¬¸ì„œ + history â†’ **ìƒˆë¡œìš´ ì§ˆë¬¸**       |
| **ë°˜ë³µ**           | 4\~7ë‹¨ê³„ë¥¼ 2ë²ˆ ë°˜ë³µ ìˆ˜í–‰í•˜ì—¬ ì§ˆì˜ ì •êµí™” ë° ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ |            |                                 |

> ë§ˆì§€ë§‰ iterationì—ì„œëŠ” ì§ˆë¬¸ ìƒì„±ì„ ìƒëµí•˜ê³ , ê´€ë ¨ ë¬¸ì„œ 4ê°œë¥¼ ìš”ì•½í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì œê³µí•©ë‹ˆë‹¤.


## Dataset

The agent utilizes the **Amazon Reviews 2023** dataset from Hugging Face, specifically Toys_and_Games.

- **Dataset**: [McAuley-Lab/Amazon-Reviews-2023](https://huggingface.co/datasets/McAuley-Lab/Amazon-Reviews-2023)
- **Subset**: `raw_meta_Toys_and_Games`, `raw_review_Toys_and_Games`


### Index Structure

- **ID**: `parent_asin`
- **Content**: Concatenation of `title`, `features`, `description` from metadata and `title`, `text` from review data.

## Retrieval Models

### 1. **BM25** (Lexical Retrieval)

* í‚¤ì›Œë“œ ì¤‘ì‹¬ì˜ ì „í†µì ì¸ í…ìŠ¤íŠ¸ ì¼ì¹˜ ê¸°ë°˜ ê²€ìƒ‰
* `bm25s` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ êµ¬í˜„
* ì´ˆê¸° ì§ˆì˜ í˜¹ì€ ì¬êµ¬ì„±ëœ ì§ˆì˜ì— ëŒ€í•´ ë¹ ë¥´ê²Œ ê´€ë ¨ ë¬¸ì„œë¥¼ ì°¾ì•„ëƒ„

### 2. **BAAI/bge-small-en-v1.5** (Dense Retrieval)

* Hugging Faceì˜ [`BAAI/bge-small-en-v1.5`](https://huggingface.co/BAAI/bge-small-en-v1.5) ëª¨ë¸ ì‚¬ìš©
* ì§ˆì˜ì™€ ë¬¸ì„œë¥¼ ì €ì°¨ì› ë²¡í„°ë¡œ ë³€í™˜í•œ í›„, **FAISS**ë¥¼ í†µí•´ ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰ ìˆ˜í–‰
* ì˜ë¯¸ ê¸°ë°˜ì˜ ìœ ì‚¬ë„ë¥¼ ë°˜ì˜í•˜ì—¬ í‚¤ì›Œë“œ ì¼ì¹˜ë§Œìœ¼ë¡œëŠ” ì–´ë ¤ìš´ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë³´ì™„

### ğŸ” Hybrid Retrieval

* ë‘ ë°©ì‹ì˜ ê²°ê³¼ë¥¼ ê²°í•©í•˜ì—¬, **ì •í™•ì„±ê³¼ ë‹¤ì–‘ì„±**ì„ ë™ì‹œì— í™•ë³´
* ìµœì¢… ê²€ìƒ‰ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±:

  * BM25 Top-K ë¬¸ì„œ
  * BGE ì„ë² ë”© Top-K ë¬¸ì„œ
  * ë‘ ê²°ê³¼ë¥¼ í†µí•©í•˜ê±°ë‚˜ ì ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì¬ì •ë ¬


## Usage

### Dependencies Installation

```bash
pip install -r requirements.txt
```

### Environment Setup

```bash
export OPENAI_API_KEY="your_openai_api_key"
```

---

## ğŸ§¾ ì‹¤í–‰ ë°©ë²•

ë³¸ ì‹œìŠ¤í…œì€ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

### â–¶ï¸ ì‹¤ì‚¬ìš©ìì™€ì˜ ëŒ€í™” (Interactive ëª¨ë“œ)

* í„°ë¯¸ë„ì—ì„œ ì§ì ‘ ì‚¬ìš©ì ì…ë ¥ì„ ë°›ì•„ ëŒ€í™”ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

```bash
python run_agent_v2_user.py
```
---

### ğŸ§ª ì‹œë®¬ë ˆì´í„° ê¸°ë°˜ í‰ê°€ (Simulation ëª¨ë“œ)

* LLM simulatorê°€ ìë™ í‰ê°€ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```bash
python run_agent_v2_simulator.py
```
---
